# Name of the workflow
name: CI Build & Release

# Triggers for running
on:
  workflow_dispatch: # This allows manually running from GitHub web UI
  push:
    branches: ["main"] # Standard CI trigger when main branch is pushed

env:
  IMAGE_TAG: ${{ github.sha }}
  IMAGE_NAME: "nanomon"
  IMAGE_REG: "bencacr2025.azurecr.io"
  REGISTRY_USERNAME: "bencacr2025"
  BUILD_INFO: "CI Build from GitHub Actions"
  VERSION: ${{ github.sha }}

# One job for building the app
jobs:
  buildJob:
    name: "Build & push images"
    runs-on: ubuntu-latest
    steps:
      # Checkout code from another repo on GitHub
      - name: "Checkout app code repo"
        uses: actions/checkout@v5
        with:
          repository: benc-uk/nanomon

      - name: "Build images"
        run: |
          docker compose -f build/compose.yaml build
